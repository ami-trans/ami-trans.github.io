<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <title>Cek Semua Tabel</title>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
    h2 { background: #333; color: #fff; padding: 6px; }
    table { border-collapse: collapse; margin-bottom: 40px; width: 100%; background: white; }
    th, td { border: 1px solid #aaa; padding: 6px; text-align: left; }
    th { background: #ddd; }
  </style>
</head>
<body>
  <h1>üìã Cek Semua Tabel & Isinya</h1>
  <div id="output">Loading...</div>

  <script>
    const supabaseUrl = "https://yxppbwrfggbgoyaiigjs.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl4cHBid3JmZ2diZ295YWlpZ2pzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgzMDk2NTEsImV4cCI6MjA3Mzg4NTY1MX0.DBRShZgj4wjMBdS6uqz0-bWtI-oaExNv_lJes4yHP_M";

    const client = supabase.createClient(supabaseUrl, supabaseKey);

    async function loadTables() {
      const container = document.getElementById("output");
      container.innerHTML = "";

      // Ambil semua tabel dengan RPC list_tables
      let { data: tables, error } = await client.rpc("list_tables");

      if (error) {
        container.innerHTML = "‚ùå Gagal ambil tabel: " + error.message;
        return;
      }

      for (let tbl of tables) {
        const tableName = tbl.table_name;
        let { data, error } = await client.from(tableName).select("*");

        // Jika error atau tabel kosong
        if (error) {
          container.innerHTML += `<h2>${tableName}</h2><p style="color:red;">‚ùå ${error.message}</p>`;
          continue;
        }
        if (!data || data.length === 0) {
          container.innerHTML += `<h2>${tableName}</h2><p><i>(kosong)</i></p>`;
          continue;
        }

        // Render tabel
        let html = `<h2>${tableName}</h2><table><thead><tr>`;
        for (let col of Object.keys(data[0])) {
          html += `<th>${col}</th>`;
        }
        html += "</tr></thead><tbody>";

        for (let row of data) {
          html += "<tr>";
          for (let col of Object.keys(row)) {
            html += `<td>${row[col] ?? ""}</td>`;
          }
          html += "</tr>";
        }
        html += "</tbody></table>";

        container.innerHTML += html;
      }
    }

    loadTables();
  </script>
</body>
</html>
